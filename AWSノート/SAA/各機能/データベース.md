# 🔹 データベースの基本概念

## 1️⃣ データベースとは？

- **大量のデータを効率的に保存・検索・更新・管理するための仕組み**。
    
- 単なるファイル保存ではなく、データを「構造化」して整理し、高速にアクセスできる。
    

👉 AWSでは「**マネージド型データベース**」として、運用（バックアップ・冗長化・スケーリング）を自動化できるのが大きな特徴。

---

## 2️⃣ データベースの種類

### （A）リレーショナルデータベース（RDB）

- データを **表（テーブル）** の形式で管理
    
- **行（レコード）** と **列（カラム）** で構造化
    
- **SQL** を使って操作
    
- **一貫性が高い**（ACID特性）
    

📌 AWS例: **Amazon RDS（MySQL, PostgreSQL, Oracle, SQL Server, MariaDB）**, **Amazon Aurora**

ユースケース → 基幹システム、ECサイト、ユーザー管理

---

### （B）NoSQLデータベース

- 表形式ではなく、**キー・バリュー型、ドキュメント型、グラフ型**など柔軟な構造
    
- **スケーラビリティが高く、大量データを高速に処理**可能
    
- RDBほど複雑なトランザクションは苦手
    

📌 AWS例: **Amazon DynamoDB（キー・バリュー型/ドキュメント型）**

ユースケース → IoT、ゲームランキング、セッション管理、モバイルアプリ

---

### （C）データウェアハウス（DWH）

- 大量の履歴データを蓄積し、**分析・BI（ビジネスインテリジェンス）** に活用
    
- トランザクション処理ではなく、集計やレポート生成に最適
    

📌 AWS例: **Amazon Redshift**

ユースケース → ビッグデータ分析、経営分析、ログ解析

---

### （D）インメモリデータベース

- データを **メモリ上に保持**し、高速アクセスを実現
    
- キャッシュやセッション管理に利用
    

📌 AWS例: **Amazon ElastiCache（Redis, Memcached）**

ユースケース → 高速キャッシュ、ランキング集計、リアルタイム分析

---

## 3️⃣ データベースの基本用語

- **スキーマ**: データベースの構造定義（テーブル設計など）
    
- **ACID特性**:
    
    - A: 原子性（All-or-Nothing）
        
    - C: 一貫性（ルール違反なし）
        
    - I: 分離性（同時実行でも矛盾なし）
        
    - D: 永続性（障害があっても保持）
        
- **スケーリング**:
    
    - 垂直スケーリング（インスタンスを大きくする）
        
    - 水平スケーリング（ノードを増やす、シャーディング・リードレプリカ）
        

---

## 4️⃣ SAAレベルで問われる観点

- **RDS vs DynamoDB** の選択基準
    
- **Auroraの特徴（高性能・高可用・自動スケーリング）**
    
- **Redshift = 分析用、ElastiCache = キャッシュ用** の区別
    
- 可用性設計（マルチAZ配置、バックアップ、自動フェイルオーバー）
    

---

💡 **まとめ**

- RDB → 構造化データ、トランザクション強い
    
- NoSQL → 柔軟スケーリング、大量データに強い
    
- DWH → 分析専用、Redshift
    
- インメモリ → 超高速アクセス、ElastiCache
試験対策（SAA/SAP）でよく問われる **RDS / Aurora / DynamoDB / Redshift / ElastiCache** を比較表にまとめます。

---

# 📊 AWS データベースサービス比較表

|サービス|種類 / エンジン|特徴|ユースケース|スケーリング|試験対策ポイント|
|---|---|---|---|---|---|
|**Amazon RDS**|リレーショナル（MySQL, PostgreSQL, MariaDB, Oracle, SQL Server）|マネージドRDB、バックアップ/パッチ適用/フェイルオーバーを自動化|トランザクション処理、既存アプリ移行|垂直スケーリング中心、一部読み取りレプリカで水平拡張可|OLTP向け、SQL使える、選択問題で「リレーショナルならRDS」|
|**Amazon Aurora**|リレーショナル（MySQL/PostgreSQL互換）|RDSの拡張版、ストレージ自動スケール、商用DB並みの性能|大規模アプリ、SaaS、ミッションクリティカルシステム|自動でストレージスケール（最大128TB）、Aurora Serverlessで自動キャパシティ調整|「高可用性かつスケーラブルなRDB → Aurora」|
|**Amazon DynamoDB**|NoSQL（Key-Value, Document）|フルマネージド、ミリ秒単位の高速応答、スキーマレス|IoT, モバイルアプリ, セッション管理|水平スケール無制限、オンデマンド容量モードあり|「NoSQL」「サーバーレス」「高スループット」がキーワード|
|**Amazon Redshift**|データウェアハウス（列指向RDB）|高速分析（OLAP）、SQL互換、ペタバイト規模に対応|BIツール連携、ビッグデータ分析|ノード追加による水平スケール|「分析用DB」「大量データ集計 → Redshift」|
|**Amazon ElastiCache**|インメモリ（Redis, Memcached）|キャッシュDB、高速レスポンス、揮発性データ|セッションキャッシュ、ランキング、リアルタイム分析|ノード追加でスケーリング、シャーディング可|「キャッシュ」「ミリ秒未満のレスポンス」ならこれ|

---

## 📝 試験対策シナリオ例

1. **Webアプリでユーザー情報を保存**  
    → SQLを使う → **RDS or Aurora**  
    → 高可用性＆スケーラビリティ重視 → **Aurora**
    
2. **ECサイトのショッピングカートやセッション管理**  
    → スキーマレス、超低レイテンシー → **DynamoDB**
    
3. **BIツールを使った売上分析**  
    → 大規模データ分析、OLAP処理 → **Redshift**
    
4. **高トラフィックのアプリで読み取り負荷軽減**  
    → RDS/DynamoDBの前段にキャッシュ → **ElastiCache**
# 📊 データベースの高可用性・耐障害性設計（AWS）

## 1. Multi-AZ（マルチAZ配置）

- **対象**: RDS, Aurora
    
- **仕組み**:  
    プライマリDBを1つのAZに、同期レプリカを別AZに配置。障害時は自動フェイルオーバー。
    
- **特徴**
    
    - 同期レプリケーション → データ損失なし
        
    - フェイルオーバー自動
        
    - 読み取りは不可（冗長化専用）
        
- **ユースケース**
    
    - ミッションクリティカルなOLTPアプリ
        
    - 単一AZ障害に備えたい場合
        
- **試験ポイント**
    
    - 「高可用性・自動フェイルオーバー」＝ **Multi-AZ**
        
    - 読み取り負荷分散には使えない → **リードレプリカを選択する
        

---

## 2. Read Replica（読み取りレプリカ）

- **対象**: RDS, Aurora, DynamoDB
    
- **仕組み**:  
    非同期レプリケーションで読み取り専用DBを複数作成
    
- **特徴**
    
    - 読み取りトラフィックを分散
        
    - 遅延がある（非同期）
        
    - 必要に応じてプライマリに昇格可能
        
- **ユースケース**
    
    - レポートやBIツール用のクエリ分散
        
    - 読み取りスループットのスケールアウト
        
- **試験ポイント**
    
    - 「読み取り性能を改善したい」＝ **リードレプリカ
        
    - 「耐障害性」目的なら **Multi-AZ**
        

---

## 3. Global Tables（グローバルテーブル）

- **対象**: DynamoDB, Aurora Global Database
    
- **仕組み**:  
    複数リージョンにまたがるDBレプリケーション
    
- **特徴**
    
    - クロスリージョンで低レイテンシーアクセス
        
    - 障害時は別リージョンが引き継げる
        
    - Auroraは1次リージョンで書き込み、他リージョンはリードレプリカ扱い（DynamoDBはマルチマスター）
        
- **ユースケース**
    
    - グローバル展開アプリ（例: 世界中で使われるSNS）
        
    - DR（ディザスタリカバリ）設計
        
- **試験ポイント**
    
    - 「マルチリージョン・低レイテンシー」＝ **Global Tables**
        
    - 「DynamoDBグローバルレプリケーション」問題は頻出
        

---

## 4. Aurora 独自の高可用性

- Auroraはストレージレベルで自動冗長化（6コピーを3AZに分散）
    
- Aurora Global Databaseで**1リージョンプライマリ + 他リージョンリードレプリカ**
    
- Aurora Serverless v2 でスケーリング自動化 → コスト効率も良い
    

---

# 📝 試験対策シナリオ例

1. **シナリオ**:  
    東京リージョンで運用中のRDSに障害が発生した際、自動で別AZに切り替えたい。  
    👉 **Multi-AZ配置**
    
2. **シナリオ**:  
    アクセス急増で読み取りトラフィックがさばけない。書き込みはそのままで、読み取りだけ分散したい。  
    👉 **リードレプリカ
    
3. **シナリオ**:  
    北米・欧州・アジアのユーザーが同じアプリを利用し、どこからでも低レイテンシーでDBにアクセスしたい。  
    👉 **DynamoDB Global Tables** または **Aurora Global Database**
    

---

✅ まとめると…

- **耐障害性・可用性 → Multi-AZ**
    
- **読み取り負荷分散 → リードレプリカ
    
- **マルチリージョン展開 → Global Tables**

# 🔐 セキュリティ観点でのDB設計（AWS）

## 1. KMSによる暗号化

- **AWS KMS (Key Management Service)** を使って暗号化キーを管理
    
- 暗号化対象:
    
    - **データ暗号化**: RDS/Aurora/DynamoDB/Redshift などは保存データを暗号化可能
        
    - **スナップショット、バックアップ、リードレプリカ**も自動で暗号化される
        
- **試験ポイント**
    
    - 「保存データ（at rest）の暗号化」＝ **KMS**
        
    - **透過的暗号化（アプリ修正不要）** が可能
        

---

## 2. IAM認証

- **RDS（MySQL/Aurora/MySQL互換）**では、DBユーザーの代わりにIAMで認証可能
    
- アプリケーションは一時的な**IAM認証トークン**でログイン
    
- **メリット**
    
    - DBにパスワードを保存しない
        
    - AWS IAMポリシーでアクセス制御可能
        
- **試験ポイント**
    
    - 「DB接続認証をパスワードレスにしたい」＝ **IAM DB認証**
        

---

## 3. VPC内配置（ネットワークセキュリティ）

- **DBは基本的にプライベートサブネットに配置**
    
    - 直接インターネット公開しない
        
    - アプリケーションサーバ（EC2/Fargate/Lambda）からのアクセスのみ許可
        
- **セキュリティグループ / NACL**
    
    - DBポート（例: MySQL 3306）だけ開放
        
    - 外部から直接アクセスする場合は **Bastion Host / Systems Manager Session Manager** を利用
        
- **試験ポイント**
    
    - 「インターネットから直接アクセス禁止 → プライベートサブネット」
        
    - 「最小権限のセキュリティグループ設定」
        

---

## 4. Secrets Manager 連携

- **AWS Secrets Manager**
    
    - DBのユーザ名・パスワードを安全に保存
        
    - 自動ローテーション（定期的に新しいパスワードに更新）
        
    - SDK経由でアプリから安全に取得
        
- **Parameter Store**（Systems Manager）との違い
    
    - Secrets Manager → パスワード、APIキーなどの「秘密情報」専用、自動ローテ可能
        
    - Parameter Store → 設定値管理用、無料枠があるが自動ローテなし
        
- **試験ポイント**
    
    - 「DBパスワードを安全に保存・自動ローテ」＝ **Secrets Manager**
        
    - 「設定値管理（暗号化可能）」＝ **Parameter Store**
        

---

# 📊 まとめ（試験対策観点）

|項目|サービス/方法|試験でのキーワード|
|---|---|---|
|保存データの暗号化|KMS|at rest暗号化、透過的|
|認証|IAM DB認証|パスワードレス、トークン|
|ネットワーク|VPCプライベートサブネット|非公開、最小権限|
|認証情報管理|Secrets Manager|パスワード保管、自動ローテ|

---

# 📝 試験シナリオ例

1. **シナリオ**:  
    セキュリティ監査で「RDSに保存される全データを暗号化する必要がある」と言われた。  
    👉 **KMS暗号化を有効化**
    
2. **シナリオ**:  
    アプリがDB接続パスワードを持たないようにしたい。  
    👉 **IAM DB認証**
    
3. **シナリオ**:  
    RDSをインターネットに公開せず、アプリのみからアクセスさせたい。  
    👉 **プライベートサブネット + セキュリティグループ制御**
    
4. **シナリオ**:  
    DBのパスワードを安全に保管し、定期的に自動更新したい。  
    👉 **Secrets Manager**

# 🛠 高可用性ネットワーク設計

## 1. Direct Connect (DX) と VPN の冗長構成

### 🔹 課題

- **Direct Connect（専用線）**は高帯域・低遅延・安定した接続を提供するが、回線障害リスクはゼロではない
    
- そのため、**バックアップ経路**が必要
    

### 🔹 ベストプラクティス構成

- **DX + VPN 冗長化**（よく試験に出る！）
    
    - メイン接続: Direct Connect
        
    - バックアップ: Site-to-Site VPN（インターネット経由）
        
    - BGPルーティングでフェイルオーバーを自動化
        
    - 例: DX障害時にVPNへ自動切替
        

### 🔹 強化版

- **Direct Connect 冗長化**
    
    - 複数のロケーションから冗長接続（異なるDXロケーションを利用）
        
    - DX Gateway経由で複数VPCへ接続可能
        

---

## 2. マルチAZ設計

### 🔹 概要

- **VPCサブネットは必ずAZ単位**
    
- DBやアプリをマルチAZに分散することで、AZ障害時でも稼働を継続できる
    

### 🔹 構成例

- **アプリ層**
    
    - EC2 Auto Scaling → 複数AZに分散配置
        
    - ELB（ALB/NLB）でトラフィック分散
        
- **DB層**
    
    - RDS Multi-AZ（同期レプリケーションでスタンバイを別AZに配置）
        
    - Aurora → マルチAZ + マルチリージョンオプション
        
- **ネットワーク層**
    
    - NAT Gateway → 各AZに配置（AZ障害対策）
        
    - VPN → 冗長トンネルを複数AZに分散
        

---

## 3. 高可用性構成の設計例

### 🌐 オンプレ接続シナリオ

1. Direct Connect（専用線）でメイン接続
    
2. バックアップとしてVPN接続を同じVPCに構成
    
3. VPC内は複数AZにサブネットを展開
    
4. アプリはELB + Auto Scalingで冗長化
    
5. DBはRDS Multi-AZ構成
    

### 📝 設計ポイント

- **単一障害点（SPOF）をなくす**
    
- **異なるAZに分散配置**
    
- **オンプレ接続はDX+VPNで二重化**
    

---

## 4. 試験シナリオ例（SAA/SAP）

1. **シナリオ**  
    会社はオンプレとAWSを専用線で接続しているが、回線断時に業務が止まってしまう。どうすべきか？  
    👉 **Direct Connect + Site-to-Site VPN 冗長化**
    
2. **シナリオ**  
    Webアプリを稼働させているが、AZ障害でダウンする可能性を下げたい。  
    👉 **Auto Scaling GroupでマルチAZにEC2配置 + ELB**
    
3. **シナリオ**  
    DBがAZ障害で停止するリスクを下げたい。  
    👉 **RDS Multi-AZ配置**
    
4. **シナリオ**  
    NAT Gatewayを1つだけ作っていたが、AZ障害で通信できなくなった。  
    👉 **各AZにNAT Gateway配置、ルートテーブルを分ける**
    

---

# ✅ まとめ

- **DX単独利用は危険 → VPNと併用**
    
- **アプリ・DB・ネットワークすべてをマルチAZに配置**
    
- **試験のキーワード**
    
    - DX + VPN 冗長化
        
    - Auto Scaling + ELB（マルチAZ）
        
    - RDS Multi-AZ
        
    - 各AZにNAT Gateway

# 🌍 リージョン障害に備える設計

## 1. マルチリージョンアーキテクチャ

### 🔹 概要

- AWSのリージョンは地理的に独立 → 1つのリージョン全体が停止するリスクに備えるには、**複数リージョンにシステムを展開する必要がある**
    
- **DR（Disaster Recovery）戦略**の一部
    

### 🔹 戦略パターン（代表4つ）

|戦略|概要|復旧時間（RTO）|コスト|
|---|---|---|---|
|**バックアップ&リストア**|バックアップを別リージョンに保存、障害時に復元|数時間〜日単位|低|
|**パイロットライト**|最小限のシステムを別リージョンで稼働、障害時にスケールアップ|数十分〜数時間|中|
|**ウォームスタンバイ**|縮小規模の本番コピーを常時稼働、障害時にスケールアップ|数分〜数時間|高|
|**マルチサイト（アクティブ/アクティブ）**|複数リージョンで同時稼働、トラフィックを分散|秒〜分|最高|

👉 SAAレベルでは「ウォームスタンバイ」「マルチサイト」がよく問われます。

---

## 2. Route 53 によるフェイルオーバー

### 🔹 DNSを使ったトラフィック制御

- **Route 53**はマルチリージョンアーキテクチャと組み合わせて利用する
    
- フェイルオーバー構成で「プライマリ障害時にセカンダリへ切替」
    

### 🔹 構成例

1. **アクティブ/パッシブ**
    
    - プライマリリージョンに本番稼働
        
    - セカンダリは待機状態
        
    - Route 53ヘルスチェックでプライマリの障害を検知 → 自動でセカンダリへルーティング
        
2. **アクティブ/アクティブ**
    
    - 両リージョンを同時稼働
        
    - Route 53の加重ルーティングやレイテンシーベースルーティングで分散
        
    - どちらかが落ちたらもう一方が全トラフィックを処理
        

---

## 3. DBのマルチリージョン設計

- **Aurora Global Database**
    
    - 1つのプライマリリージョン + 複数のリード専用リージョン
        
    - 非同期レプリケーション（<1秒遅延）
        
    - 災害時にはリージョン昇格して書込み可能に
        
- **DynamoDB Global Tables**
    
    - マルチリージョン・マルチマスター
        
    - どのリージョンからでも読み書き可能
        
- **RDSクロスリージョンリードレプリカ**
    
    - 手動フェイルオーバー
        
    - コストを抑えつつDR構成可能
        

---

## 4. 試験シナリオ例（SAA/SAP）

1. **シナリオ**  
    会社は東日本リージョン(ap-northeast-1)で稼働しているWebアプリを西日本リージョン(ap-northeast-3)にバックアップしたい。障害時はDNSで切替。  
    👉 **Route 53 フェイルオーバー構成 + RDSクロスリージョンリードレプリカ**
    
2. **シナリオ**  
    世界中のユーザーに対してレイテンシの低い応答を提供したい。同時にDR構成にもしたい。  
    👉 **マルチリージョンアクティブ/アクティブ + Route 53 レイテンシーベースルーティング**
    
3. **シナリオ**  
    金融システムで、リージョン障害時にも数分以内に復旧が必要。  
    👉 **Aurora Global Database + Route 53 フェイルオーバー**
    
4. **シナリオ**  
    コスト重視でDRを実現したい。復旧に数時間かかっても良い。  
    👉 **バックアップ&リストア戦略（S3クロスリージョンレプリケーション）**
    

---

# ✅ まとめ

- **AZ障害** → マルチAZ構成
    
- **リージョン障害** → マルチリージョン構成（バックアップ〜マルチサイト）
    
- **Route 53 フェイルオーバー** → 自動切替の仕組み
    
- **DBのマルチリージョン化** → Aurora Global DB / DynamoDB Global Tables